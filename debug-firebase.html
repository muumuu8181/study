<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebaseèªè¨¼ãƒ‡ãƒãƒƒã‚°</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .log-area {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        button {
            background: #4285f4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #357ae8;
        }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        .warning { color: orange; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Firebaseèªè¨¼ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</h1>
        
        <div>
            <button onclick="checkEnvironment()">1. ç’°å¢ƒãƒã‚§ãƒƒã‚¯</button>
            <button onclick="testSimpleAuth()">2. ã‚·ãƒ³ãƒ—ãƒ«èªè¨¼ãƒ†ã‚¹ãƒˆ</button>
            <button onclick="testGoogleAuth()">3. Googleèªè¨¼ãƒ†ã‚¹ãƒˆ</button>
            <button onclick="checkAuthDomains()">4. èªè¨¼ãƒ‰ãƒ¡ã‚¤ãƒ³ç¢ºèª</button>
            <button onclick="clearLog()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
        </div>
        
        <h3>ãƒ­ã‚°:</h3>
        <div class="log-area" id="logArea"></div>
    </div>
    
    <script>
        // Firebaseè¨­å®šï¼ˆåŒã˜è¨­å®šã‚’ä½¿ç”¨ï¼‰
        const firebaseConfig = {
            "apiKey": "AIzaSyA5PXKChizYDCXF_GJ4KL6Ylq9K5hCPXWE",
            "authDomain": "shares-b1b97.firebaseapp.com",
            "databaseURL": "https://shares-b1b97-default-rtdb.firebaseio.com",
            "projectId": "shares-b1b97",
            "storageBucket": "shares-b1b97.firebasestorage.app",
            "messagingSenderId": "38311063248",
            "appId": "1:38311063248:web:0d2d5726d12b305b24b8d5"
        };
        
        // FirebaseåˆæœŸåŒ–
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        
        // ãƒ­ã‚°æ©Ÿèƒ½
        function log(message, type = 'info') {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString('ja-JP');
            const logEntry = `[${timestamp}] ${message}\n`;
            logArea.innerHTML += `<span class="${type}">${logEntry}</span>`;
            logArea.scrollTop = logArea.scrollHeight;
            console.log(message);
        }
        
        function clearLog() {
            document.getElementById('logArea').innerHTML = '';
            log('ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'info');
        }
        
        // ç’°å¢ƒãƒã‚§ãƒƒã‚¯
        function checkEnvironment() {
            log('=== ç’°å¢ƒãƒã‚§ãƒƒã‚¯é–‹å§‹ ===', 'info');
            log('ç¾åœ¨ã®URL: ' + window.location.href, 'info');
            log('ãƒ›ã‚¹ãƒˆå: ' + window.location.hostname, 'info');
            log('ãƒ—ãƒ­ãƒˆã‚³ãƒ«: ' + window.location.protocol, 'info');
            log('ãƒãƒ¼ãƒˆ: ' + (window.location.port || 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ'), 'info');
            
            log('\nFirebaseè¨­å®š:', 'info');
            log('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID: ' + firebaseConfig.projectId, 'info');
            log('èªè¨¼ãƒ‰ãƒ¡ã‚¤ãƒ³: ' + firebaseConfig.authDomain, 'info');
            log('APIã‚­ãƒ¼: ' + firebaseConfig.apiKey.substring(0, 10) + '...', 'info');
            
            log('\nãƒ–ãƒ©ã‚¦ã‚¶æƒ…å ±:', 'info');
            log('User Agent: ' + navigator.userAgent.substring(0, 50) + '...', 'info');
            
            // GitHub Pagesåˆ¤å®š
            if (window.location.hostname.includes('github.io')) {
                log('\nâš ï¸ GitHub Pagesã§å®Ÿè¡Œä¸­', 'warning');
                log('Firebase Consoleã§ "' + window.location.hostname + '" ã®è¿½åŠ ãŒå¿…è¦', 'warning');
            }
            
            log('=== ç’°å¢ƒãƒã‚§ãƒƒã‚¯å®Œäº† ===', 'success');
        }
        
        // ã‚·ãƒ³ãƒ—ãƒ«èªè¨¼ãƒ†ã‚¹ãƒˆ
        async function testSimpleAuth() {
            log('=== ã‚·ãƒ³ãƒ—ãƒ«èªè¨¼ãƒ†ã‚¹ãƒˆé–‹å§‹ ===', 'info');
            
            try {
                // åŒ¿åèªè¨¼ã‚’è©¦ã™
                log('åŒ¿åèªè¨¼ã‚’è©¦è¡Œä¸­...', 'info');
                const result = await auth.signInAnonymously();
                log('âœ… åŒ¿åèªè¨¼æˆåŠŸï¼', 'success');
                log('ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: ' + result.user.uid, 'success');
                
                // ã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆ
                await auth.signOut();
                log('ã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆå®Œäº†', 'info');
                
            } catch (error) {
                log('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
                log('ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰: ' + error.code, 'error');
            }
            
            log('=== ã‚·ãƒ³ãƒ—ãƒ«èªè¨¼ãƒ†ã‚¹ãƒˆå®Œäº† ===', 'info');
        }
        
        // Googleèªè¨¼ãƒ†ã‚¹ãƒˆ
        async function testGoogleAuth() {
            log('=== Googleèªè¨¼ãƒ†ã‚¹ãƒˆé–‹å§‹ ===', 'info');
            
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                log('Googleãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼è¨­å®šå®Œäº†', 'info');
                log('ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‹ã„ã¦ã„ã¾ã™...', 'info');
                
                const result = await auth.signInWithPopup(provider);
                log('âœ… Googleèªè¨¼æˆåŠŸï¼', 'success');
                log('ãƒ¦ãƒ¼ã‚¶ãƒ¼å: ' + result.user.displayName, 'success');
                log('ãƒ¡ãƒ¼ãƒ«: ' + result.user.email, 'success');
                log('UID: ' + result.user.uid, 'success');
                
                // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ
                log('\nãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›¸ãè¾¼ã¿ãƒ†ã‚¹ãƒˆ...', 'info');
                await database.ref('debug-test/' + result.user.uid).set({
                    timestamp: Date.now(),
                    name: result.user.displayName,
                    test: 'success'
                });
                log('âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›¸ãè¾¼ã¿æˆåŠŸï¼', 'success');
                
                // ã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆ
                await auth.signOut();
                log('ã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆå®Œäº†', 'info');
                
            } catch (error) {
                log('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
                log('ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰: ' + error.code, 'error');
                
                if (error.code === 'auth/unauthorized-domain') {
                    log('\nğŸš¨ é‡è¦: èªè¨¼ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼', 'error');
                    log('Firebase Consoleã§ä»¥ä¸‹ã®æ‰‹é †ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„:', 'warning');
                    log('1. https://console.firebase.google.com/ ã«ã‚¢ã‚¯ã‚»ã‚¹', 'warning');
                    log('2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ "shares-b1b97" ã‚’é¸æŠ', 'warning');
                    log('3. Authentication â†’ Settings â†’ Authorized domains', 'warning');
                    log('4. "' + window.location.hostname + '" ã‚’è¿½åŠ ', 'warning');
                }
            }
            
            log('=== Googleèªè¨¼ãƒ†ã‚¹ãƒˆå®Œäº† ===', 'info');
        }
        
        // èªè¨¼ãƒ‰ãƒ¡ã‚¤ãƒ³ç¢ºèª
        function checkAuthDomains() {
            log('=== èªè¨¼ãƒ‰ãƒ¡ã‚¤ãƒ³ç¢ºèª ===', 'info');
            log('ç¾åœ¨ã®ãƒ‰ãƒ¡ã‚¤ãƒ³: ' + window.location.hostname, 'info');
            log('\nFirebase Consoleã§è¨±å¯ãŒå¿…è¦ãªãƒ‰ãƒ¡ã‚¤ãƒ³:', 'warning');
            log('- localhost (ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆç”¨)', 'info');
            log('- muumuu8181.github.io (GitHub Pagesç”¨)', 'info');
            log('- shares-b1b97.firebaseapp.com (Firebase Hosting)', 'info');
            log('\nç¢ºèªURL:', 'info');
            log('https://console.firebase.google.com/project/shares-b1b97/authentication/settings', 'info');
            log('=== ç¢ºèªå®Œäº† ===', 'info');
        }
        
        // åˆæœŸåŒ–æ™‚ã®çŠ¶æ…‹ç¢ºèª
        auth.onAuthStateChanged((user) => {
            if (user) {
                log('ğŸ” èªè¨¼æ¸ˆã¿: ' + (user.displayName || user.uid), 'success');
            } else {
                log('ğŸ”“ æœªèªè¨¼', 'info');
            }
        });
        
        // åˆæœŸãƒ­ã‚°
        log('Firebaseèªè¨¼ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«èµ·å‹•', 'info');
        log('Firebase SDK v8.10.0', 'info');
    </script>
</body>
</html>
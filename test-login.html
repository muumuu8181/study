<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ­ã‚°ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆ</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            font-size: 16px;
            cursor: pointer;
        }
        #log {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>ğŸ” Firebaseãƒ­ã‚°ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆ</h1>
    
    <div>
        <button onclick="testLogin()">ğŸ” Googleã§ãƒ­ã‚°ã‚¤ãƒ³</button>
        <button onclick="testLogout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        <button onclick="checkStatus()">çŠ¶æ…‹ç¢ºèª</button>
        <button onclick="clearLog()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
    </div>
    
    <div id="status">
        <h3>ç¾åœ¨ã®çŠ¶æ…‹:</h3>
        <p id="userStatus">æœªãƒ­ã‚°ã‚¤ãƒ³</p>
    </div>
    
    <div id="log">
        ãƒ­ã‚°å‡ºåŠ›ã‚¨ãƒªã‚¢
    </div>
    
    <script>
        // Firebaseè¨­å®š
        const firebaseConfig = {
            "apiKey": "AIzaSyA5PXKChizYDCXF_GJ4KL6Ylq9K5hCPXWE",
            "authDomain": "shares-b1b97.firebaseapp.com",
            "databaseURL": "https://shares-b1b97-default-rtdb.firebaseio.com",
            "projectId": "shares-b1b97",
            "storageBucket": "shares-b1b97.firebasestorage.app",
            "messagingSenderId": "38311063248",
            "appId": "1:38311063248:web:0d2d5726d12b305b24b8d5"
        };
        
        // FirebaseåˆæœŸåŒ–
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        
        // ãƒ­ã‚°é–¢æ•°
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString('ja-JP');
            const logEntry = `[${timestamp}] ${message}\n`;
            const span = document.createElement('span');
            span.className = type;
            span.textContent = logEntry;
            logDiv.appendChild(span);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function clearLog() {
            document.getElementById('log').innerHTML = 'ãƒ­ã‚°ã‚¯ãƒªã‚¢å®Œäº†\n';
        }
        
        // Googleãƒ­ã‚°ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆ
        async function testLogin() {
            log('========== Googleãƒ­ã‚°ã‚¤ãƒ³é–‹å§‹ ==========', 'info');
            log('ç¾åœ¨ã®URL: ' + window.location.href, 'info');
            log('ç¾åœ¨ã®ãƒ‰ãƒ¡ã‚¤ãƒ³: ' + window.location.hostname, 'info');
            
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                log('Googleãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ä½œæˆå®Œäº†', 'info');
                
                log('ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‹ã„ã¦ã„ã¾ã™...', 'info');
                const result = await auth.signInWithPopup(provider);
                
                log('âœ… ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸï¼', 'success');
                log('ãƒ¦ãƒ¼ã‚¶ãƒ¼å: ' + result.user.displayName, 'success');
                log('ãƒ¡ãƒ¼ãƒ«: ' + result.user.email, 'success');
                log('UID: ' + result.user.uid, 'success');
                
                updateStatus(result.user);
                
                // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ
                log('ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›¸ãè¾¼ã¿ãƒ†ã‚¹ãƒˆ...', 'info');
                await database.ref('test-login/' + result.user.uid).set({
                    timestamp: Date.now(),
                    name: result.user.displayName,
                    test: 'success'
                });
                log('âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›¸ãè¾¼ã¿æˆåŠŸï¼', 'success');
                
            } catch (error) {
                log('âŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿï¼', 'error');
                log('ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰: ' + error.code, 'error');
                log('ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ' + error.message, 'error');
                
                if (error.code === 'auth/unauthorized-domain') {
                    log('ğŸš¨ èªè¨¼ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼', 'error');
                    log('Firebase Consoleã§ ' + window.location.hostname + ' ã‚’è¿½åŠ ã—ã¦ãã ã•ã„', 'error');
                } else if (error.code === 'auth/popup-blocked') {
                    log('ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ', 'error');
                } else if (error.code === 'auth/popup-closed-by-user') {
                    log('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸ', 'info');
                }
            }
        }
        
        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
        async function testLogout() {
            try {
                await auth.signOut();
                log('âœ… ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæˆåŠŸ', 'success');
                updateStatus(null);
            } catch (error) {
                log('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
            }
        }
        
        // çŠ¶æ…‹ç¢ºèª
        function checkStatus() {
            const user = auth.currentUser;
            if (user) {
                log('âœ… ãƒ­ã‚°ã‚¤ãƒ³ä¸­: ' + user.displayName, 'success');
            } else {
                log('âŒ æœªãƒ­ã‚°ã‚¤ãƒ³', 'info');
            }
        }
        
        // çŠ¶æ…‹æ›´æ–°
        function updateStatus(user) {
            const statusDiv = document.getElementById('userStatus');
            if (user) {
                statusDiv.innerHTML = `
                    <span class="success">âœ… ãƒ­ã‚°ã‚¤ãƒ³ä¸­</span><br>
                    åå‰: ${user.displayName}<br>
                    ãƒ¡ãƒ¼ãƒ«: ${user.email}
                `;
            } else {
                statusDiv.innerHTML = '<span class="info">âŒ æœªãƒ­ã‚°ã‚¤ãƒ³</span>';
            }
        }
        
        // èªè¨¼çŠ¶æ…‹ã®ç›£è¦–
        auth.onAuthStateChanged((user) => {
            if (user) {
                log('ğŸ” èªè¨¼çŠ¶æ…‹: ãƒ­ã‚°ã‚¤ãƒ³ä¸­ (' + user.displayName + ')', 'success');
                updateStatus(user);
            } else {
                log('ğŸ”“ èªè¨¼çŠ¶æ…‹: æœªãƒ­ã‚°ã‚¤ãƒ³', 'info');
                updateStatus(null);
            }
        });
        
        // åˆæœŸãƒ­ã‚°
        log('FirebaseåˆæœŸåŒ–å®Œäº†', 'info');
        log('ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸æº–å‚™å®Œäº†', 'info');
    </script>
</body>
</html>